2025-12-15 13:54:50 INFO app.memory.manager: Loading full history from Mongo (3w)
2025-12-15 13:54:54 INFO app.memory.mongo: INSIDE SAVE_MESSAGE IN <== MONGO SERVICE ==> (3w) SAVED SUCCESSFULLY
2025-12-15 13:54:54 INFO app.memory.manager: Saved to Mongo (3w) Ran
2025-12-15 13:54:58 INFO app.memory.manager: Saved to Redis (3w) Ran
2025-12-15 13:54:58 INFO app.services.horizon: Memory Save With Role User Succeeded: top 10 projects by revenue and their selcted suppliers and total labor
2025-12-15 13:54:58 INFO app.services.horizon: the init state--->{'user_input': 'top 10 projects by revenue and their selcted suppliers and total labor', 'chat_history': [HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), AIMessage(content='"SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, p.total_quote_value AS revenue FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code WHERE p.deleted_at IS NULL ORDER BY p.total_quote_value DESC LIMIT 10;"', additional_kwargs={}, response_metadata={})], 'chat_id': '3w'}
2025-12-15 13:54:58 INFO intent_node: *************landed into intent node*************
2025-12-15 13:54:58 INFO intent_node: History .....
2025-12-15 13:54:58 INFO intent_node: [HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), AIMessage(content='"SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, p.total_quote_value AS revenue FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code WHERE p.deleted_at IS NULL ORDER BY p.total_quote_value DESC LIMIT 10;"', additional_kwargs={}, response_metadata={})]
2025-12-15 13:54:58 INFO app.models.llm.factory: get_llm called with explicit llm_name=do_serverless
2025-12-15 13:54:58 INFO app.models.llm.factory: Building LLM provider for key=do_serverless
2025-12-15 13:54:58 INFO app.models.llm.do_llama: Initializing DigitalOcean Serverless Inference model_id=None base_url=None
2025-12-15 13:54:58 INFO app.models.llm.do_llama: Initializing DigitalOcean Serverless Inference model_id=llama3.3-70b-instruct base_url=https://inference.do-ai.run/v1
2025-12-15 13:55:00 INFO httpx: HTTP Request: POST https://inference.do-ai.run/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-15 13:55:00 INFO intent_node: generated response in intention---->intent='text_to_sql' post_actions=[] params={} requires_multistep=False
2025-12-15 13:55:00 INFO intent_node: intention detected---->{'intent': 'text_to_sql', 'post_actions': [], 'params': {}, 'requires_multistep': False}
2025-12-15 13:55:00 INFO graph>node>sqlgen: landed in sql generation node 2 steps 
2025-12-15 13:55:00 INFO app.models.llm.factory: get_llm called with explicit llm_name=do_serverless
2025-12-15 13:55:00 INFO app.models.llm.factory: Building LLM provider for key=do_serverless
2025-12-15 13:55:00 INFO app.models.llm.do_llama: Initializing DigitalOcean Serverless Inference model_id=None base_url=None
2025-12-15 13:55:00 INFO app.models.llm.do_llama: Initializing DigitalOcean Serverless Inference model_id=llama3.3-70b-instruct base_url=https://inference.do-ai.run/v1
2025-12-15 13:55:03 INFO httpx: HTTP Request: POST https://inference.do-ai.run/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-15 13:55:03 INFO graph>node>sqlgen: The response for schema modules -> modules=['projects_module', 'project_labours_module', 'project_vendors_module']
2025-12-15 13:55:03 INFO graph>node>sqlgen: Parsed modules dict -> {'modules': ['projects_module', 'project_labours_module', 'project_vendors_module']}
2025-12-15 13:55:03 INFO graph>node>sqlgen: Extracted modules list -> ['projects_module', 'project_labours_module', 'project_vendors_module']
2025-12-15 13:55:04 INFO httpx: HTTP Request: POST https://stagingapi.horizoncenter.co/horizon-extra-works/mcp/api/v1/schema "HTTP/1.1 200 OK"
2025-12-15 13:55:04 INFO graph>node>sqlgen: the response after get schema from laravel {'sum
2025-12-15 13:55:09 INFO httpx: HTTP Request: POST https://inference.do-ai.run/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-15 13:55:09 INFO graph>node>sqlgen: sql_response output: {"sql": "SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, SUM(rfs.total) AS revenue, SUM(rfs.labour_value) AS total_labour, GROUP_CONCAT(DISTINCT rfs.supplier_name) AS selected_suppliers FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code JOIN horizon_extra_work_tool.rfq_suppliers AS rfs ON p.id = rfs.project_id WHERE p.deleted_at IS NULL AND rfs.deleted_at IS NULL GROUP BY p.id, p.project_title, p.site_name, ps.name, p.cbre_interal_work_order ORDER BY revenue DESC LIMIT 10"}
2025-12-15 13:55:09 INFO graph>node>sqlgen: [SQLGEN] cleaned model output: SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, SUM(rfs.total) AS revenue, SUM(rfs.labour_value) AS total_labour, GROUP_CONCAT(DISTINCT rfs.supplier_name) AS selected_suppliers FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code JOIN horizon_extra_work_tool.rfq_suppliers AS rfs ON p.id = rfs.project_id WHERE p.deleted_at IS NULL AND rfs.deleted_at IS NULL GROUP BY p.id, p.project_title, p.site_name, ps.name, p.cbre_interal_work_order ORDER BY revenue DESC LIMIT 10
2025-12-15 13:55:09 INFO SQL_EXECUTION: sql execution node received ---> SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, SUM(rfs.total) AS revenue, SUM(rfs.labour_value) AS total_labour, GROUP_CONCAT(DISTINCT rfs.supplier_name) AS selected_suppliers FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code JOIN horizon_extra_work_tool.rfq_suppliers AS rfs ON p.id = rfs.project_id WHERE p.deleted_at IS NULL AND rfs.deleted_at IS NULL GROUP BY p.id, p.project_title, p.site_name, ps.name, p.cbre_interal_work_order ORDER BY revenue DESC LIMIT 10;
2025-12-15 13:55:09 INFO SQL_EXECUTION: Executing SQL query: SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, SUM(rfs.total) AS revenue, SUM(rfs.labour_value) AS total_labour, GROUP_CONCAT(DISTINCT rfs.supplier_name) AS selected_suppliers FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code JOIN horizon_extra_work_tool.rfq_suppliers AS rfs ON p.id = rfs.project_id WHERE p.deleted_at IS NULL AND rfs.deleted_at IS NULL GROUP BY p.id, p.project_title, p.site_name, ps.name, p.cbre_interal_work_order ORDER BY revenue DESC LIMIT 10; in tool_execute_sql
2025-12-15 13:55:10 INFO httpx: HTTP Request: POST https://stagingapi.horizoncenter.co/horizon-extra-works/mcp/api/v1/execute-sql "HTTP/1.1 200 OK"
2025-12-15 13:55:10 INFO SQL_EXECUTION: sql execution rows executed ---> {'status': 'success', 'data': [{'project_title': 'UPM-Nasir File-test', 'site_name': 'Witting Group', 'project_status_name': 'SOR Submitted / Draft', 'cbre_interal_work_order': 'KR-EW-12122025-13128', 'revenue': 13000, 'total_labour': 7000, 'selected_suppliers': 'Harber and Sons'}, {'project_title': 'UPM-testt active', 'site_name': "Lahore ( Clarisync _ don't use this site)", 'project_status_name': 'Offer Approved', 'cbre_interal_work_order': 'PK-EW-13122025-13132', 'revenue': 3000, 'total_labour': 1000, 'selected_suppliers': 'Nowhere service'}]}
2025-12-15 13:55:10 INFO app.services.horizon: the final state--->{'user_input': 'top 10 projects by revenue and their selcted suppliers and total labor', 'intent': 'text_to_sql', 'chat_history': [HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), HumanMessage(content='top 10 projects by revenue', additional_kwargs={}, response_metadata={}), AIMessage(content='"SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, p.total_quote_value AS revenue FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code WHERE p.deleted_at IS NULL ORDER BY p.total_quote_value DESC LIMIT 10;"', additional_kwargs={}, response_metadata={})], 'chat_id': '3w', 'sql': 'SELECT p.project_title, p.site_name, ps.name AS project_status_name, p.cbre_interal_work_order, SUM(rfs.total) AS revenue, SUM(rfs.labour_value) AS total_labour, GROUP_CONCAT(DISTINCT rfs.supplier_name) AS selected_suppliers FROM horizon_extra_work_tool.projects AS p JOIN horizon_extra_work_tool.project_statuses AS ps ON p.project_status_code = ps.status_code JOIN horizon_extra_work_tool.rfq_suppliers AS rfs ON p.id = rfs.project_id WHERE p.deleted_at IS NULL AND rfs.deleted_at IS NULL GROUP BY p.id, p.project_title, p.site_name, ps.name, p.cbre_interal_work_order ORDER BY revenue DESC LIMIT 10;', 'rows_data': [{'project_title': 'UPM-Nasir File-test', 'site_name': 'Witting Group', 'project_status_name': 'SOR Submitted / Draft', 'cbre_interal_work_order': 'KR-EW-12122025-13128', 'revenue': 13000, 'total_labour': 7000, 'selected_suppliers': 'Harber and Sons'}, {'project_title': 'UPM-testt active', 'site_name': "Lahore ( Clarisync _ don't use this site)", 'project_status_name': 'Offer Approved', 'cbre_interal_work_order': 'PK-EW-13122025-13132', 'revenue': 3000, 'total_labour': 1000, 'selected_suppliers': 'Nowhere service'}], 'export': False, 'email': False, 'post_actions': [], 'requires_multistep': False}
2025-12-15 13:55:10 INFO app.memory.mongo: INSIDE SAVE_MESSAGE IN <== MONGO SERVICE ==> (3w) SAVED SUCCESSFULLY
2025-12-15 13:55:10 INFO app.memory.manager: Saved to Mongo (3w) Ran
2025-12-15 13:55:15 INFO app.memory.manager: Saved to Redis (3w) Ran
